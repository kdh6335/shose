<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com/shose/mybatis/ShoseMapper.xml">

  <select id="newpdtview" resultType="pDTO" parameterType="String">
  
   			SELECT * FROM new_pro_view
   			
  </select>
  
  <select id="bestview" resultType="pDTO" parameterType="String">
  
   			SELECT * FROM best_pro_view
   			
  </select>
  
  <select id="memlogin" resultType="java.util.HashMap" parameterType="String">

  			SELECT * FROM member WHERE mid = #{id} and mpw = #{pw}
  			
  </select>
  
  <select id="memIdCheck" resultType="mDto">
  
  			SELECT * FROM member WHERE mid = #{mid}
  			
  </select>
  
  
  <select id="sessionLogin" resultType="mDto">
  
  			SELECT * FROM member WHERE mid = #{mid} AND mpw = #{mpw}
  		
  </select>
  

  
  <insert id="memIsert" >
  		
  			INSERT INTO member (mid, mpw, mname, mphone, mjusonum, mjuso, mjuso2,  memail, memail2, mbirthyear, mbirthmonth, mbirthday, mmen) 
  			VALUES ( #{mid}, #{mpw}, #{mname}, #{mphone}, #{mjusonum},#{mjuso}, #{mjuso2}, #{memail}, #{memail2}, #{mbirthyear}, #{mbirthmonth}, #{mbirthday}, #{mmen} )
  
  </insert>
  
   <select id="boardlistAll" resultType="com.shose.DTO.BoardDTO">
  
  			SELECT * FROM tblboard ORDER by bno desc
  		
  	</select>
  	
  	<insert id="insertBoard" >
  	
	  		INSERT INTO tblboard (bno, title, content, writer) 
	  		VALUES(seq_tblboard_bno.NEXTVAL, #{title} , #{content} ,#{writer})
	  		
  	</insert>
  	
  	
  	<select id="bodylist" resultType="boardDTO" >
  
  			SELECT * FROM tblboard WHERE bno = #{bno}
  		
  	</select>
  	
  	<select id="modfiyList" resultType="boardDTO" >
  
  			SELECT * FROM tblboard WHERE bno = #{bno}
  		
  	</select>
  	
	 <update id="modfiyUpdate">
	  	
	  		UPDATE tblboard SET title = #{title}, content= #{content}, writer = #{writer} WHERE bno = #{bno}
	  		
	 </update>
  	
	 <delete id="modifDelete" parameterType="Integer">
	  	
	  		DELETE FROM tblboard WHERE bno = #{bno}
	  	
	 </delete>
 
	 <update id="bodylistRead">
	  	
	   		UPDATE tblboard SET viewont = viewont + 1 WHERE bno = #{bno}
	  		
	 </update>
	 
	  <update id="bodyseetadd">
	  	
	   		UPDATE tblboard SET sweet = sweet + 1 WHERE bno = #{bno}
	  		
	 </update>
 
	 <!-- <![CDATA[]]> 쓰는 이유는 ">" 를 텍스트 파일로 인식하는 것을 방지 하기 위해서 사용 한다.  -->
	 <select id="countPaging" resultType="int">
	 
	 		SELECT count(bno)
	 		FROM tblboard
	 		
	 	<![CDATA[
	 		WHERE bno > 0 
	 	]]>
	 	
	 	<choose>
	    	<when test="select.equals('제목')">
	 			AND	 title LIKE '%'||#{search}||'%'
	 		</when>
	 		<when test="select.equals('내용')">
	 			AND	 content LIKE '%'||#{search}||'%'
	 		</when>
	 		<when test="select.equals('제목내용')">
	 			AND	 content LIKE '%'||#{search}||'%' OR title LIKE '%'||#{search}||'%'
	 		</when>
	 		<when test="select.equals('아이디')">
	 			AND	 writer = #{search}
	 		</when>
 		</choose>
	 
	 </select>
 
 <select id="listCriteria" resultType="boardDTO">
 	<![CDATA[
 		SELECT * 
 		FROM (
 			SELECT rownum rnum,
 			a.*
 			FROM( 
 				SELECT * 
 				FROM tblboard
 				WHERE bno > 0
 				ORDER BY bno desc
 				) a
 		)
 		WHERE rnum BETWEEN #{pageStart} AND #{perPageNum}
 	]]>
 </select>
 
  <select id="bodynext" resultType="nDTO" >
  <![CDATA[
  SELECT * FROM (
					SELECT
						bno
					    , TITLE
					    , writer
					    , regdate 
					    , LEAD(bno, 1 ) OVER (ORDER BY bno DESC) AS next_article_bno
					    , LEAD(TITLE, 1 , '다음글 없음') OVER (ORDER BY bno DESC) AS next_title
					    , LEAD(writer, 1 , '') OVER (ORDER BY bno DESC) AS next_writer
					    , LEAD(regdate, 1 , '') OVER (ORDER BY bno DESC) AS next_regdate
					    , LAG(bno, 1) OVER (ORDER BY bno DESC ) AS  pre_article_bno
					    , LAG(TITLE, 1 , '이전글없음') OVER (ORDER BY bno DESC ) pre_title
					    , LAG(writer, 1) OVER (ORDER BY bno DESC ) AS  pre_writer
					    , LAG(regdate, 1) OVER (ORDER BY bno DESC ) AS pre_regdate
					FROM
					tblboard
				) WHERE bno= #{bno}
	]]>
 </select>
 
 
 	<select id="replyList" resultType="rDTO">
 		SELECT * FROM tblreply WHERE bno=#{bno}
 	</select>
 	
 	<select id="replycount" resultType="rDTO">
 		SELECT count(*) AS count FROM tblreply WHERE bno=#{bno}
 	</select>
 	
 	<insert id="replyinsert" >
 		 INSERT INTO tblreply (rno, content, writer, bno)
 		VALUES (seq_tblreply_rno.NEXTVAL, #{content}, #{writer} , #{bno})
 	</insert>
 	
 	<delete id="replydelete">
 	
 		DELETE FROM tblreply WHERE rno = #{rno}
 		
 	</delete>
 	
 	<delete id="replyAllDelete">
 	
 		DELETE FROM tblreply WHERE bno = #{bno}
 		
 	</delete>
 	
 	<update id="countUpdate">
 	
 		UPDATE tblboard SET count = #{count}  WHERE bno = #{bno}
 		
 	</update>
 	
 	<select id="searchTitle" resultType="boardDTO" >
 		
 		
 		SELECT * 
 		FROM (
 			SELECT rownum rnum,
 			a.*
 			FROM( 
 				SELECT * 
 				FROM tblboard
 				<![CDATA[
 				WHERE bno > 0 AND
 					]]>
 	<choose>
    	<when test="select.equals('제목')">
 				 title LIKE '%'||#{search}||'%'
 		</when>
 		<when test="select.equals('내용')">
 				 content LIKE '%'||#{search}||'%'
 		</when>
 		<when test="select.equals('제목내용')">
 				 content LIKE '%'||#{search}||'%' OR title LIKE '%'||#{search}||'%'
 		</when>
 		<when test="select.equals('아이디')">
 				 writer = #{search}
 		</when>
 	</choose>
 				ORDER BY bno desc
 				) a
 		)
 		WHERE rnum BETWEEN #{pageStart} AND #{perPageNum}
 
 		
 	</select>
 	
 	<select id="searchContent" resultType="boardDTO" >
 		
 		<![CDATA[
 		SELECT * 
 		FROM (
 			SELECT rownum rnum,
 			a.*
 			FROM( 
 				SELECT * 
 				FROM tblboard
 				WHERE bno > 0 AND content LIKE '%'||#{search}||'%'
 				ORDER BY bno desc
 				) a
 		)
 		WHERE rnum BETWEEN #{pageStart} AND #{perPageNum}
 	]]>
 		
 	</select>
 	
 	<select id="searchTitleContent" resultType="boardDTO" >
 		
 		<![CDATA[
 		SELECT * 
 		FROM (
 			SELECT rownum rnum,
 			a.*
 			FROM( 
 				SELECT * 
 				FROM tblboard
 				WHERE bno > 0 AND content LIKE '%'||#{search}||'%' OR title LIKE '%'||#{search}||'%'
 				ORDER BY bno desc
 				) a
 		)
 		WHERE rnum BETWEEN #{pageStart} AND #{perPageNum}
 	]]>
 		
 	</select>
 	
 	 	<select id="searchWriter" resultType="boardDTO" >
 		
 		<![CDATA[
 		SELECT * 
 		FROM (
 			SELECT rownum rnum,
 			a.*
 			FROM( 
 				SELECT * 
 				FROM tblboard
 				WHERE bno > 0 AND writer = #{search}
 				ORDER BY bno desc
 				) a
 		)
 		WHERE rnum BETWEEN #{pageStart} AND #{perPageNum}
 	]]>
 		
 	</select>
 	
 	
 	<select id="personalSelect" resultType="mDto" parameterType="String">
 	
 		SELECT * FROM member WHERE mid = #{mid}
 		
 	</select>
 	
 	<update id="passwordUpdate">
 	
 		UPDATE member SET mpw= #{mpw} WHERE mid = #{mid}
 	
 	</update>
 	
 	<update id="memUpdate">
 	
 		UPDATE member SET mphone = #{mphone}, mjusonum = #{mjusonum}, mjuso = #{mjuso}, mjuso2 = #{mjuso2}, memail =#{memail} , memail2 = #{memail2}, 
 		mbirthyear= #{mbirthyear}, mbirthmonth = #{mbirthmonth}, mbirthday = #{mbirthday}  
 		WHERE mid = #{mid} 
 	
 	</update>
 	
 	<delete id="memDelete">
 	
 		DELETE FROM member WHERE mid = #{mid}
 	
 	</delete>
  
</mapper>